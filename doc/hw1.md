# VLSI-CAD Homework #1
éº¦æ™¯ 1700012751

---

å…³äºç¼–è¯‘å’Œè¿è¡Œæœ¬ä»£ç çš„æŒ‡ç¤ºè§`README.md`.

```bash

git submodule update
mkdir build && cd build
cmake ..
make
```

## Problem #1

`tautology checking` é—®é¢˜çš„å®šä¹‰ä¸ºç»™å®šä¸€ä¸ªå•è¾“å‡ºç”µè·¯, é—®æ˜¯å¦å¯¹äºä»»æ„è¾“å…¥, è¾“å‡ºæ’å®šä¸ºå‡. è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªå¸¸ç”¨çš„è§£æ³•æ˜¯æ„é€ Binary Decision Diagram(BDD), å¹¶åˆ¤æ–­å‹ç¼©åçš„Reduced Order Binary Decision Diagram(ROBDD)æ˜¯å¦ä¸è¾“å‡ºæ’ä¸ºå‡çš„ç”µè·¯åŒæ„.  ä½†æ˜¯ç”±äºæ­¤é—®é¢˜æœ¬èº«æ˜¯ä¸€ä¸ªNP-hardé—®é¢˜, å› æ­¤ç›®å‰ä¸å­˜åœ¨é€šç”¨ç®—æ³•æŠŠä»»æ„BDDåŒ–ç®€åˆ°æœ€ç®€å½¢å¼. ä¸€ä¸ªé€šå¸¸çš„åšæ³•æ˜¯åœ¨BDDå†…éƒ¨è¿›è¡Œéå†, åªéœ€åˆ¤æ–­æ˜¯å¦å­˜åœ¨åˆ°è¾¾ç»“æœä¸ºçœŸçš„è·¯å¾„å³å¯. åŒæ—¶, æ³¨æ„åˆ°è¾“å…¥æ–‡ä»¶æ˜¯`cube list`æ ¼å¼, è¿™å®é™…ä¸Šç»™å‡ºäº†ä¸€ä¸ªç‰¹æ®Šçš„Sum of Product(SOP)å½¢å¼çš„ç”µè·¯; å…¶ä¸­å¯¹äºæ¯ä¸ªproduct, æˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•åœ°æ„é€ å…¶ROBDD; æ„é€ å®Œæ‰€æœ‰productçš„ROBDDå, å¯ä»¥åŒæ—¶å¯¹æ‰€æœ‰çš„productå¯¹åº”çš„ROBDDè¿›è¡ŒORæ“ä½œçš„åˆå¹¶, å…³é”®éƒ¨åˆ†çš„ä¼ªä»£ç å¦‚ä¸‹, å…¶å¯¹åº”äºæ–‡ä»¶`bdd.cpp`ä¸­çš„å‡½æ•°`BDDOperator::OR`:

```c++
BDD op(BDD g, BDD h) {
	if (g is a leaf or h is a leaf) // termination condition:
																  // either g = 0 or 1, or h = 0 or 1
		return proper BDD;
	var x = min(root(g), root(h)) // get the lowest order 
  var BDD fLo = op(negCofBDD(g, x), negCofBDD(h, x)); 
  BDD fHi = op(posCofBDD(g, x), posCofBDD(h, x)); 
  return combineBDD(x, fLo, fHi);
}
```

å‡è®¾å˜é‡ä¸ªæ•°ä¸º$n$â€‹, åœ¨æœ€åæƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦æ„é€ çš„BDDçš„èŠ‚ç‚¹æ•°ä¸º$O(2^n)$, æœ€åæ—¶ç©ºå¤æ‚åº¦å‡ä¸º$O(2^n)$.

åœ¨ç¼–è¯‘å®Œæˆæœ¬ä»£ç å, è¾“å…¥`make run_autology`å³å¯è¿è¡Œç»™å‡ºçš„æ‰€æœ‰benchmark, å…¶è¿è¡Œç»“æœä¸º:

| Benchmarks | ğŸ¤” Is it tautology? |
| :--------: | :----------------: |
|  V20_c77   |         No         |
|   v2_c54   |        Yes         |
|  v17_c58   |         No         |
|  v11_c36   |         No         |
|   v5_c10   |         No         |
|  v19_c59   |         No         |
|  v12_c92   |         No         |
|  v16_c19   |         No         |
|   v3_c79   |        Yes         |
|  v13_c24   |         No         |
|            |                    |

## Problem #2

åˆ¤æ–­ä¸¤ä¸ªç”µè·¯æ˜¯å¦æ˜¯å®Œå…¨ç­‰ä»·æ˜¯é€»è¾‘ç»¼åˆä¸­çš„å¸¸è§é—®é¢˜. å¯¹äºè¿™ä¸¤ä¸ªç”µè·¯, æŠŠå…¶è¾“å‡ºå¼‚æˆ–å, å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–°çš„ç”µè·¯, è‹¥è¿™ä¸ªç”µè·¯çš„è¾“å‡ºæ’ä¸ºå‡, å³æ˜¯å¦æ˜¯tautology, åˆ™å¯åˆ¤æ–­è¿™ä¸¤ä¸ªç”µè·¯æ˜¯å®Œå…¨ç­‰ä»·çš„. å…¶ä¸­åˆ¤æ–­ç”µè·¯æ˜¯å¦æ˜¯tautology, é™¤äº†ç¬¬ä¸€é¢˜ä¸­çš„ä½¿ç”¨BDDçš„åšæ³•, æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨SAT solver.

[ABC][https://github.com/vlab-cs-ucsb/ABC]æ˜¯ä¸€ä¸ªåœ¨VLSIé¢†åŸŸå¸¸ç”¨çš„SAT solver. å…¶ä½¿ç”¨äº†`MiniSAT` æ¥æ±‚è§£SAT é—®é¢˜. ABCå¸¸ç”¨çš„å‘½ä»¤åŒ…æ‹¬`miter`, `sat`(æˆ– `dsat`), `write_cnf`ç­‰, æ›´å…·ä½“çš„æ“ä½œæŒ‡ä»¤å¯è§[æ­¤](http://vlsicad.eecs.umich.edu/BK/Slots/cache/www-cad.eecs.berkeley.edu/~alanmi/abc/). å…¶ä¸­åœ¨æœ¬é—®é¢˜ä¸­, å¯¹äºè¾“å…¥çš„ä¸¤ä¸ªBLIFæ ¼å¼çš„æ–‡ä»¶`f1.blif`å’Œ`f2.blif`, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥åˆ¤æ–­:

```bash
abc 01> miter f1.blif f2.blif
abc 02> strash
abc 03> write_cnf f12_miter.cnf (optional)
abc 03> dsat
UNSATISFIABLE Time = 0.02 sec
```

å…¶ä¸­`UNSATISFIABLE`è¡¨ç¤ºè¯¥SATé—®é¢˜è¢«åˆ¤å®šä¸ºâ€œä¸å¯æ»¡è¶³â€, å³è¾“å‡ºæ’ä¸ºå‡, è¿™å¯¹åº”äºæˆ‘ä»¬ç»™å‡ºçš„ä¸¤ä¸ªç”µè·¯æ˜¯å®Œå…¨ç­‰ä»·çš„; ä¸ä¹‹å¯¹åº”, è‹¥SATé—®é¢˜è¢«åˆ¤å®šä¸ºâ€œå¯æ»¡è¶³â€, è¿™å¯¹åº”äºæˆ‘ä»¬ç»™å‡ºçš„ä¸¤ä¸ªç”µè·¯ä¸æ˜¯å®Œå…¨ç­‰ä»·çš„.

åœ¨ç¼–è¯‘å®Œæˆæœ¬ä»£ç å, è¿è¡Œ`make run_equivalence`å³å¯æµ‹è¯•. ç»™å‡ºçš„benchmarkçš„ç»“æœä¸º:

| Benchmarks |     Equivalence     |
| :--------: | :-----------------: |
|   router   | {1, 3, 5} {2,4, 6}  |
|  priority  | {1, 3, 4} {2, 5, 6} |
|    max     | {1, 2, 6} {3, 4, 5} |
|   cavlc    | {1, 2, 5} {3, 4, 6} |
| Int2float  | {1, 2, 3} {4, 5, 6} |
|            |                     |

## Problem #3

`technology mapping`é—®é¢˜æ˜¯æŒ‡æŠŠä¸€ä¸ªç”µè·¯ä¸­çš„é€»è¾‘å…³ç³»æ˜ å°„æˆstandard cell libraryä¸­, ä½¿å¾—è¯¥é€»è¾‘ç”µè·¯å¯ä»¥è¢«æ˜ å°„åˆ°å®é™…çš„ç‰©ç†å™¨ä»¶ä¸Š. å…¶ä¸­åœ¨æœ¬é—®é¢˜ä¸­, å…è®¸çš„standard cell libraryä¸º{INV, NAND2, NOR2, AOI21, AOI22}, ç›®æ ‡æ˜¯ä¼˜åŒ–ä½¿ç”¨å°½å¯èƒ½å°‘çš„cellæ•°é‡å’Œå°½å¯èƒ½å°çš„æ·±åº¦. 

å¦‚æœè¯¥ç½‘è¡¨æ°å¥½æ˜¯æ ‘å½¢æœºæ„, å³æ¯ä¸ªé€»è¾‘é—¨çš„fan outä¸ªæ•°è‡³å¤šä¸ºä¸€, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‘å½¢åŠ¨æ€è§„åˆ’æ¥æ±‚è§£è¿™ä¸ªé—®é¢˜. æ³¨æ„åˆ°INVè¿™ä¸ªstandard cellæ˜¯ä¸å¯èƒ½åœ¨æœ€ç»ˆçš„æ–¹æ¡ˆä¸­ç›´æ¥ç›¸è¿(å¦åˆ™æˆ‘ä»¬ä¸€å®šå¯ä»¥åˆ å»ä¸€ä¸ªå¹¶æ„é€ å‡ºæ›´ä¼˜çš„è§£), å¯¹äºåŸç”µè·¯ä¸­æ¯ä¸ªèŠ‚ç‚¹, æˆ‘ä»¬åˆ†åˆ«è®¾ç½®ä¸¤ä¸ªåŠ¨æ€è§„åˆ’çš„çŠ¶æ€, åˆ†åˆ«è¡¨ç¤ºå¦‚æœç­‰ä»·è¡¨ç¤ºè¯¥å­æ ‘è¾“å‡ºçš„, ä»¥åŠè¯¥å­æ ‘è¾“å‡ºçš„å–å, è‡³å°‘éœ€è¦å¤šå°‘ä¸ªcell, ä»¥åŠcellä¸ªæ•°æœ€å°‘æ—¶è‡³å°‘éœ€è¦å¤šå°‘æ·±åº¦. å‡è®¾èŠ‚ç‚¹ä¸ªæ•°ä¸º$n$, æ­¤åŠ¨æ€è§„åˆ’çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦å‡ä¸º$O(n)$.

æ³¨æ„åˆ°å®é™…é—®é¢˜ä¸­ä¸€ä¸ªèŠ‚ç‚¹fan outå¯èƒ½å¤§äºä¸€, è¿™æ—¶å€™ä¸€ä¸ªå¸¸è§çš„tradeoffæ˜¯åˆ’åˆ†æˆå¤šæ£µæ ‘ç„¶ååˆ†åˆ«è¿›è¡ŒåŠ¨æ€è§„åˆ’, è¿™æ—¶å€™å…¶å®ä¸èƒ½ä¿è¯å¾—å‡ºç»“æœçš„æœ€ä¼˜æ€§çš„, æœ¬ä»£ç ä¹Ÿé‡‡å–äº†ç±»ä¼¼çš„åšæ³•. å…¶ä¸­æ­¤åšæ³•è¿˜å¯èƒ½å¯¼è‡´å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜:

- åˆ’åˆ†ä¸ºå¤šæ£µæ ‘ä¹‹å, å®é™…ä¸Šå„æ£µæ ‘ä¹‹é—´é‡å éƒ¨åˆ†è¾ƒå¤š, ä½“ç°åœ¨åŠ¨æ€è§„åˆ’çŠ¶æ€çš„å€¼ä¸Šæ˜¯å…¶ä¸ºæŒ‡æ•°å¢é•¿çš„, å› æ­¤ä»£ç é‡Œä½¿ç”¨äº†`long double`æ¥å­˜å‚¨.
- å¦‚æœå¦‚æœåœ¨å¦ä¸€æ£µæ ‘ä¸­ä½¿ç”¨`AOI21`, `AOI22`ç­‰standard cell, ä½†åœ¨å¦ä¸€æ£µæ ‘æ ‘ä¸­ä½¿ç”¨äº†å…¶å†…éƒ¨èŠ‚ç‚¹, è¿™æ—¶å€™å…¶å®åœ¨ç”Ÿæˆæœ€ç»ˆæ–¹æ¡ˆçš„æ—¶å€™ä¼šæœ‰éƒ¨åˆ†ç”µè·¯æ— æ³•è¢«é‡ç”¨, å› æ­¤åœ¨æœ¬ä»£ç ä¸­è§„å®šå¦‚æœä½¿ç”¨`AOI21`, `AOI22`ç­‰standard cell, å…¶å†…éƒ¨èŠ‚ç‚¹çš„fan outä¸ªæ•°åªèƒ½ä¸º1.

ç¼–è¯‘å®Œæˆæœ¬ä»£ç å, è¿è¡Œ`make run_techmap 1> /dev/null` å¯ä»¥å¾—åˆ°å„benchmarkçš„ç”Ÿæˆæ–¹æ¡ˆçš„ç»Ÿè®¡ç»“æœ; `ctest -R techmap`å¯ä»¥ä½¿ç”¨ä¸Šé¢˜æ‰€è¿°çš„ABC solveréªŒè¯è¾“å‡ºæ–¹æ¡ˆäºåŸæ–¹æ¡ˆçš„ç­‰ä»·æ€§. æ³¨æ„ç”±äºä½¿ç”¨äº†`AOI21`, `AOI22`ç­‰standard cell, ä½¿ç”¨ABC solveråˆ¤å®šç­‰ä»·æ€§åœ¨ç”¨æ—¶è¿‡é•¿, å› æ­¤å»ºè®®åœ¨è¿è¡Œ`ctest`æ—¶è®¾ç½®timeout. åœ¨[The EPFL Combinational Benchmark Suite](https://github.com/lsils/benchmarks)ä¸­è¿è¡Œç»“æœçš„ç»Ÿè®¡å¦‚ä¸‹, å…¶ä¸­otheråŒ…æ‹¬å¸¸æ•°è¾“å…¥, æ’ç­‰é€»è¾‘é—¨ç­‰.

| Benchmarks | # of gates | INV   | NAND2 | NOR2  | AOI21 | AOI22 | Others | Max depth |
| ---------- | ---------- | ----- | ----- | ----- | ----- | ----- | ------ | --------- |
| dec        | 604        | 300   | 292   | 12    | 0     | 0     | 0      | 6         |
| voter      | 16240      | 5595  | 104   | 8328  | 1313  | 900   | 0      | 103       |
| router     | 390        | 163   | 67    | 87    | 35    | 11    | 27     | 87        |
| priority   | 1167       | 497   | 15    | 451   | 100   | 104   | 0      | 249       |
| i2c        | 1470       | 490   | 205   | 484   | 175   | 101   | 15     | 21        |
| bar        | 2831       | 1159  | 514   | 262   | 128   | 768   | 0      | 16        |
| hyp        | 241653     | 73615 | 31879 | 98045 | 9251  | 8183  | 0      | 32482     |
| mem_ctrl   | 47327      | 16712 | 1791  | 13918 | 12766 | 1866  | 1      | 134       |
| int2float  | 257        | 81    | 31    | 82    | 42    | 21    | 0      | 17        |
| adder      | 1151       | 388   | 128   | 506   | 1     | 1     | 0      | 256       |
| sin        | 6651       | 2595  | 724   | 2333  | 638   | 336   | 0      | 263       |
| div        | 73842      | 18167 | 547   | 53571 | 1541  | 16    | 0      | 4403      |
| arbiter    | 12413      | 6078  | 63    | 768   | 5504  | 0     | 0      | 87        |
| log2       | 36959      | 11901 | 3649  | 15646 | 4524  | 1239  | 0      | 489       |
| max        | 2616       | 1176  | 72    | 389   | 533   | 446   | 0      | 295       |
| multiplier | 24459      | 7144  | 102   | 9262  | 6155  | 1796  | 9      | 288       |
| sqrt       | 28028      | 7237  | 307   | 16665 | 2811  | 8     | 9      | 6054      |
| square     | 18533      | 4967  | 1861  | 8370  | 1746  | 1587  | 2      | 254       |
| cavlc      | 674        | 192   | 40    | 274   | 125   | 43    | 9      | 21        |
| ctrl       | 183        | 56    | 7     | 78    | 34    | 7     | 1      | 11        |

